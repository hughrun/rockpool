{>head}
  {>header}
    <!-- vuejs prototyping FIXME: this should be a local prod file -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <section class="main">
      <div id="user-info">
        <message-list v-bind:messages="messages"></message-list>
        <div v-if="user.admin">
          <button class="" type="button" onclick="location.href='/admin'">Admin</button>
        </div>
        <h3 class="form-label">Your Info</h3>
        <form v-if="editing" name="user-info" method="POST">
          <div>
            <label for="email">Email:</label>
            <input id="email" name="email" v-model="user.email">
          </div>
          <div>
            <label for="twitter">Twitter:</label>
            <input id="twitter" name="twitter" v-model="user.twitter">
          </div>
          <div>
            <label for="mastodon">Mastodon:</label>
            <input id="mastodon" name="mastodon" v-model="user.mastodon">
          </div>
          <button class="" v-on:click.prevent="updateUser" id="update-button">Update</button>
        </form>
        <div v-else>
          <div class="user-info">
            <div id="email"><span class="form-label">Email: </span>{{ user.email }}</div>
            <div id="twitter"><span class="form-label">Twitter: </span>{{ user.twitter }}</div>
            <div id="mastodon"><span class="form-label">Mastodon: </span>{{ user.mastodon }}</div>
          </div>
          <button class="" v-on:click="editing = true">Edit</button>
        </div>
        <form id="pocket" class="pocket-info">
          <template v-if="user.pocket">
              <p>You are subscribed to receive articles straight to your <strong>{{ user.pocket.username }}</strong> Pocket list. Nice one!</p>
              <button v-on:click="cancelPocket" type="button">Cancel Pocket Subscription</button>
          </template>
          <button class="" v-else type="button" onclick="location.href='/user/pocket'">Subscribe via Pocket</button>
        </form>
      </div>
      <!-- FIXME: this should be a vue component with subcomponents -->
      <h3 class="form-label">Your blogs</h3>
      <div id="user-approved-blogs">
        <message-list v-bind:messages="messages"></message-list>
        <ul class="blog-list">
          <li v-for='blog in blogs' class="listed-blog" v-bind:class="{deleting: blog.deleting, editing: blog.editing}" v-bind:key="blog.id">
            <div class="approved-blog"></div>
            <span v-if="blog.title"><a v-bind:href="blog.url">{{ blog.title }}</a></span>
            <span v-else>{{ blog.url }}</span>
            <form class="blog-editing-form" v-if="blog.editing" name="blog-info" method="POST">
              <label for="category">Category:</label>
              <select v-model="blog.category" name="category">
                <option v-for="cat in blogCategories" v-bind:value="cat">{{ cat }}</option>
              </select>
              <button class="" v-on:click.prevent="editBlog(blog, blogs.indexOf(blog))" id="update-button">Confirm update</button>
              <button class="" v-on:click.prevent="cancelEditing(blog, blogs.indexOf(blog))">Cancel</button>
            </form>
            <button class="" v-else v-bind:class="{hidden: blog.deleting}" v-on:click="checkingEditing(blog)" v-bind:id="blog.idString">Update</button>
            <button class="" v-if="blog.deleting" v-on:click="deleteBlog(blog)" v-bind:id="blog.idString">Confirm deletion</button>
            <span v-else-if="blog.editing"></span>
            <button class="" v-else v-on:click="checkingDeletion(blog)" v-bind:id="blog.idString">Delete</button>
          </li>
        </ul>
      </div>
      <div id="user-unapproved-blogs">
        <message-list v-bind:messages="messages"></message-list>
        <ul class="blog-list" >
          <li v-for='blog in uBlogs' v-bind:key="blog.idString" class="listed-blog">
            <div class="unapproved-blog"></div>
            <span v-if="blog.title"><a v-bind:href="blog.url">{{ blog.title }}</a></span>
            <span v-else>{{ blog.url }}</span>
            <span class="awaiting-approval"> - awaiting approval</span>
          </li>
        </ul>
        <register-or-claim-blogs @validate-url="validate"></register-or-claim-blogs>
      </div>
    </section>
    <!-- make blog category data available to vue -->
    <!-- FIXME: can we not do this another way? -->
    <script type="text/javascript">
      var blogCategories = '{blogCategories}'.split(',');
      var legacy = Boolean.valueOf({legacy})
    </script>
    <!-- vuejs components -->
    <script src="/scripts/user-vue.js"></script>
  {>footer}
{>foot}