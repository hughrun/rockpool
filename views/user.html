{>head}
  {>header}
    <!-- vuejs prototyping TODO: this should be a local prod file -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <section class="main">
      <div id="user-info">
        <message-list v-bind:messages="messages"></message-list>
        <div v-if="user.admin">
          <button type="button" onclick="location.href='/admin'">Admin</button>
        </div>
        <h3 class="form-label">Your Info</h3>
        <form v-if="editing" name="user-info" method="POST">
          <div>
            <label for="email">Email:</label>
            <input id="email" name="email" v-model="user.email">
          </div>
          <div>
            <label for="twitter">Twitter:</label>
            <input id="twitter" name="twitter" v-model="user.twitter">
          </div>
          <div>
            <label for="mastodon">Mastodon:</label>
            <input id="mastodon" name="mastodon" v-model="user.mastodon">
          </div>
          <button v-on:click.prevent="updateUser" id="update-button">Update</button>
        </form>
        <div v-else>
          <div id="email"><span class="form-label">Email: </span>{{ user.email }}</div>
          <div id="twitter"><span class="form-label">Twitter: </span>{{ user.twitter }}</div>
          <div id="mastodon"><span class="form-label">Mastodon: </span>{{ user.mastodon }}</div>
          <button v-on:click="editing = true">Edit</button>
        </div>
        <div>
            <h3 class="form-label">Pocket</h3>
              <form id="pocket">
                <template v-if="user.pocket">
                    <p>You are subscribed to receive articles straight to your <strong>{{ user.pocket.username }}</strong> Pocket list. Nice one!</p>
                    <button v-on:click="cancelPocket" type="button">Cancel Pocket Subscription</button>
                </template>
                <button v-else type="button" onclick="location.href='/user/pocket'">Subscribe via Pocket</button>
              </form>
          </div>
      </div>
      <!-- FIXME: this should be a vue component with subcomponents -->
      <h3 class="form-label">Your blogs</h3>
      <div id="user-approved-blogs">
        <message-list v-bind:messages="messages"></message-list>
        <ul class="blog-list">
          <li v-for='blog in blogs' class="listed-blog" v-bind:class="{deleting: blog.editing}" v-bind:key="blog.id">
            <div class="approved-blog"></div>
            <span>{{ blog.url }}</span>
            <button v-if="blog.editing" v-on:click="deleteBlog(blog)" v-bind:id="blog.idString">Confirm deletion</button>
            <button v-else v-on:click="checking(blog)" v-bind:id="blog.idString">Delete</button>
          </li>
        </ul>
      </div>
      <div id="user-unapproved-blogs">
        <message-list v-bind:messages="messages"></message-list>
        <ul class="blog-list" >
          <li v-for='blog in uBlogs' v-bind:key="blog.idString" class="listed-blog">
            <div class="unapproved-blog"></div>
            <span>{{ blog.url }}</span><span class="awaiting-approval"> - awaiting approval</span>
          </li>
        </ul>
        <register-or-claim-blogs @validate-url="validate"></register-or-claim-blogs>
      </div>
    </section>
    <!-- make blog category data available to vue -->
    <script type="text/javascript">
      var blogCategories = '{blogCategories}'.split(',');
      var legacy = Boolean.valueOf({legacy})
    </script>
    <!-- vuejs components -->
    <script src="/scripts/user-vue.js"></script>
  {>footer}
{>foot}