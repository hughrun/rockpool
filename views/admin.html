{>head}
  {>header}
    <!-- vuejs prototyping -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <section class="main">
      <div v-if="messages" id="user-messages">
        <ul v-for="msg in messages" class="blog-list">
          <li v-bind:class="msg.class">{{ msg.text }}</li>
        </ul>
      </div>
      <section v-if="approvals" id="blogs-for-approval">
        <h2>Awaiting Approval</h2>
        <div v-for="user in approvals" class="claimed-blogs">
          <div><strong>Email:</strong> <a v-bind:href="'mailto:' + user.email">{{ user.email }}</a></div>
          <div><strong>Twitter:</strong> <a v-bind:href="'https://twitter.com/' + user.twitter">{{ user.twitter }}</a></div>
          <div><strong>Mastodon:</strong> {{ user.mastodon }}</div>
          <div><strong>{if legacy}Claiming or {/if}Awaiting Approval:</strong></div>
          <blogs-for-approval v-bind:blogs="user.claims" v-bind:email="user.email" v-bind:reason="null"></blogs-for-approval>
        </div>
        <div v-else>There are no blogs awaiting approval.</div>
      </section>

    <div class="failing-feeds">
      <h2>Failing feeds</h2>
      {if failing}
      <div class="flash-warning">You have failing feeds to attend to</div>
      {else}
      <div>You have no failing feeds to attend to.</div>
      {/if}
      
      {if failing}
      <p>These blog feeds are currently failing. Note that this may be a temporary glitch: always do your homework before deleting a blog from {appName}</p>
      {for blog in failing}
        <form action="/admin/deleteblog" method="post" class="blog-list">
          <!-- TODO: these need to be deleted one by one so we can update each user before deleting the blog -->
          <a href="{blog.feed}">{blog.url}</a>
          <input type="hidden" name="id" value={blog.idString} class="admin-checkbox">
          <input type="submit" id="deleteFailing" class="delete-button" value="Delete">
        </form>
      {/for}
      {/if}
      <div class="administrators">
        <h2>Administrators</h2>
        {if admins}
        <ul class="blog-list">
          {for user in admins}
          <li>
            <div class="admin-listing"><span>{user.email}</span><button class="delete-button" form="removeAdmin" type="submit">Remove as admin</button></div>
            <form action="/admin/remove-admin" id="removeAdmin"  method="post">
              <input name="user" type="hidden" value={user.email}>
            </form>
          </li>
          {/for}
        </ul>
        {else}
          <div>You are currently the only administrator. You should add someone else in case you get hit by a bus.</div>
        {/if}
        <div class="make-admin">
          <p>You should trust any user you make an administrator - they will have the power to remove your own admin rights!</p>
          <form action="/admin/add-admin" id="makeAdmin"  method="post">
            <label class="form-label" for="user">User email:</label>
            <input name="user" type="email">
            <button class="add-button" form="makeAdmin" type="submit">Make user admin</button>
          </form>
        </div>
      </div>
    </section>
    <script src="/scripts/admin.js"></script>
  {>footer}
{>foot}